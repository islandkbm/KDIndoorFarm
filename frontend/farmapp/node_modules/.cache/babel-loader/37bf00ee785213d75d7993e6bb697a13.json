{"ast":null,"code":"const AutoControlStatus = require(\"./autocontrolstatus\");\n\nmodule.exports = class AutoControl {\n  constructor(mconfig) {\n    this.mConfig = mconfig;\n    this.mState = new AutoControlStatus(mconfig.UniqID);\n  }\n\n  static Clonbyjsonobj(mobj) {\n    return new AutoControl(mobj.mConfig);\n  } //테스트용 나중에 삭제..\n\n\n  controlbypwm() {\n    let mstatus = true;\n\n    if (this.mState.pwmonoffstate === true) {\n      this.mState.pwmontime_count++;\n\n      if (this.mState.pwmontime_count >= this.mConfig.pwmontime) {\n        this.mState.pwmofftime_count = 0;\n        this.mState.pwmonoffstate = false;\n      }\n\n      mstatus = true;\n    } else {\n      this.mState.pwmofftime_count++;\n\n      if (this.mState.pwmofftime_count >= this.mConfig.pwmofftime) {\n        this.mState.pwmontime_count = 0;\n        this.mState.pwmonoffstate = true;\n      }\n\n      mstatus = false;\n    }\n\n    return mstatus;\n  }\n\n  controlbytimer() {\n    console.log(\"istimer.. : \" + this.mConfig.name);\n    return true;\n  }\n\n  controlbysensor(msensors) {\n    let mstatus = null;\n\n    for (const ms of msensors) {\n      if (ms.UniqID === this.mConfig.sensorid) {\n        if (this.mConfig.condition === \"up\") {\n          if (ms.value > this.mConfig.onvalue) {\n            mstatus = true;\n          } else {\n            if (ms.value < this.mConfig.offvalue) {\n              mstatus = false;\n            }\n          }\n        } else {\n          if (ms.value < this.mConfig.onvalue) {\n            mstatus = true;\n          } else {\n            if (ms.value > this.mConfig.offvalue) {\n              mstatus = false;\n            }\n          }\n        }\n\n        break;\n      }\n    }\n\n    return mstatus;\n  } //자동제어로 동작한후 상태가 변경되면  true  리턴\n\n\n  ischangebycontrol(msensors, timesecnow) {\n    let mstatus = false;\n\n    if (this.mConfig.enabled === false) {\n      return false;\n    }\n\n    if (timesecnow >= this.mConfig.starttime && timesecnow < this.mConfig.endtime) {\n      console.log(\"istimer.. : \" + this.mConfig.name + \" timer:\" + this.mConfig.istimer);\n\n      if (this.mConfig.istimer === true) {\n        mstatus = this.controlbytimer();\n      } else if (this.mConfig.pwmcontrolenable === true) {\n        mstatus = this.controlbypwm();\n      } else {\n        mstatus = this.controlbysensor(msensors);\n      }\n    } else {\n      mstatus = false;\n    }\n\n    return this.mState.ischangestatecheck(mstatus);\n  }\n\n};","map":{"version":3,"sources":["H:/KBM_WORK/indoorfarm_work/sfu3300/KDIndoorFarm/frontend/farmapp/src/commonjs/autocontrol.js"],"names":["AutoControlStatus","require","module","exports","AutoControl","constructor","mconfig","mConfig","mState","UniqID","Clonbyjsonobj","mobj","controlbypwm","mstatus","pwmonoffstate","pwmontime_count","pwmontime","pwmofftime_count","pwmofftime","controlbytimer","console","log","name","controlbysensor","msensors","ms","sensorid","condition","value","onvalue","offvalue","ischangebycontrol","timesecnow","enabled","starttime","endtime","istimer","pwmcontrolenable","ischangestatecheck"],"mappings":"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","sourcesContent":["const AutoControlStatus = require(\"./autocontrolstatus\");\r\n\r\n\r\nmodule.exports = class AutoControl {\r\n  constructor(mconfig) {\r\n    this.mConfig = mconfig;\r\n    this.mState = new AutoControlStatus(mconfig.UniqID);\r\n  }\r\n\r\n  static Clonbyjsonobj(mobj) {\r\n    return new AutoControl(mobj.mConfig);\r\n  }\r\n\r\n  //테스트용 나중에 삭제..\r\n  controlbypwm() {\r\n    let mstatus = true;\r\n\r\n    if (this.mState.pwmonoffstate === true) {\r\n      this.mState.pwmontime_count++;\r\n      if (this.mState.pwmontime_count >= this.mConfig.pwmontime) {\r\n        this.mState.pwmofftime_count = 0;\r\n        this.mState.pwmonoffstate = false;\r\n      }\r\n      mstatus = true;\r\n    } else {\r\n      this.mState.pwmofftime_count++;\r\n      if (this.mState.pwmofftime_count >= this.mConfig.pwmofftime) {\r\n        this.mState.pwmontime_count = 0;\r\n        this.mState.pwmonoffstate = true;\r\n      }\r\n\r\n      mstatus = false;\r\n    }\r\n\r\n    return mstatus;\r\n  }\r\n  controlbytimer() {\r\n    console.log(\"istimer.. : \" + this.mConfig.name) ;\r\n    return true;\r\n  }\r\n  controlbysensor(msensors) {\r\n    let mstatus = null;\r\n\r\n    for (const ms of msensors) {\r\n      if (ms.UniqID === this.mConfig.sensorid) {\r\n        if (this.mConfig.condition === \"up\") {\r\n          if (ms.value > this.mConfig.onvalue) {\r\n            mstatus = true;\r\n          } else {\r\n            if (ms.value < this.mConfig.offvalue) {\r\n              mstatus = false;\r\n            }\r\n          }\r\n        } else {\r\n          if (ms.value < this.mConfig.onvalue) {\r\n            mstatus = true;\r\n          } else {\r\n            if (ms.value > this.mConfig.offvalue) {\r\n              mstatus = false;\r\n            }\r\n          }\r\n        }\r\n\r\n        break;\r\n      }\r\n    }\r\n\r\n    return mstatus;\r\n  }\r\n  //자동제어로 동작한후 상태가 변경되면  true  리턴\r\n  ischangebycontrol(msensors, timesecnow) {\r\n    let mstatus = false;\r\n    if (this.mConfig.enabled === false) {\r\n      return false;\r\n    }\r\n\r\n    if (timesecnow >= this.mConfig.starttime && timesecnow < this.mConfig.endtime) {\r\n\r\n      console.log(\"istimer.. : \" + this.mConfig.name + \" timer:\" + this.mConfig.istimer ) ;\r\n\r\n      if (this.mConfig.istimer === true) {\r\n        mstatus = this.controlbytimer();\r\n      } else if (this.mConfig.pwmcontrolenable === true) {\r\n        mstatus = this.controlbypwm();\r\n      } else {\r\n        mstatus = this.controlbysensor(msensors);\r\n      }\r\n    } else {\r\n      mstatus = false;\r\n    }\r\n    return this.mState.ischangestatecheck(mstatus);\r\n  }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}